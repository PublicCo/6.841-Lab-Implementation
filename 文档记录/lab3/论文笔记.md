# raft笔记

在上一节（第四节）中，我们了解了一个强一致性的系统VMware FT。但是这个系统有个问题：我们的目标是实现复制来提高容错。但是如果要两个master所在的网络不同，那么他们互相都觉得自己是master（我们假设使用test and set服务的两个client也在两个网络，如果它是单点服务那它挂了系统就挂了；如果它也是多拷贝那么也会出现两个主机不在同一个网络的情况。）这样会出现brain-split。

刚开始这只能通过人工操作解决网络故障，但是新的方法是**多半票决**。假如现在有三个（或者五个）master，如果你要实现leader选举挑出primary去和client交互，那么**你需要有超过总数一半的主机同意这个选举**。这意味着它可以容纳不到一般的主机出现异常状况。

* 实现这个算法的理由如下：我们要检查每次更新leader会不会导致副本变动。上一个leader拥有过半的主机同意这个请求，那么这一批主机是知道leader的版本的（它们的log应当一致）；而新的leader必须拥有过半主机同意，这意味着上一次leader和这一次leader中，必然有至少一台机器都同意了这个请求。又因为如果机器同意这个请求，那么它们一定知道leader的版本，所以旧leader和新leader的版本一定是合理的不会出现brain split

## leader选举